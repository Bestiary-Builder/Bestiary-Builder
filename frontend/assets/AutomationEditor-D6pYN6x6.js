import{d as J,P as O,Q as $,R,S as b,V,M as z,k as I,W as T,X as Q,I as Z,h as w,t as c,_ as x,r as E,y as tt,o as m,c as h,b as o,a as d,l as y,A as D,D as j,e as M,i as A,f as k,z as et,F as L,H as U,p as at,j as ot}from"./index-BB4lYkn2.js";import{Y as f,L as nt,p as it}from"./utils-Brg5zYRj.js";import{M as rt}from"./Modal-BChtR01s.js";import{M as st}from"./index-BMSQkwth.js";var lt=Object.defineProperty,ut=Object.defineProperties,dt=Object.getOwnPropertyDescriptors,B=Object.getOwnPropertySymbols,ct=Object.prototype.hasOwnProperty,mt=Object.prototype.propertyIsEnumerable,H=(t,e,a)=>e in t?lt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,F=(t,e)=>{for(var a in e||(e={}))ct.call(e,a)&&H(t,a,e[a]);if(B)for(var a of B(e))mt.call(e,a)&&H(t,a,e[a]);return t},pt=(t,e)=>ut(t,dt(e));const P={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}};function ht(t,e){const a=$(()=>{const{width:n,height:p}=t;return pt(F({},P.wrapper),{width:n,height:p})}),r=$(()=>F(F({},P.fullWidth),!e.value&&P.hide));return{wrapperStyle:a,containerStyle:r}}function ft(){const t=O(T.__getMonacoInstance()),e=I(!1);let a;return z(()=>{t.value||(a=T.init(),a.then(n=>t.value=n).catch(n=>{n?.type!=="cancelation"&&(e.value=!0,console.error("Monaco initialization error:",n))}))}),{monacoRef:t,unload:()=>a?.cancel(),isLoadFailed:e}}function W(t){return typeof t=="function"?t():t}function X(t){return t===void 0}function q(t,e,a,r){return vt(t,r)||gt(t,e,a,r)}function vt(t,e){return t.editor.getModel(K(t,e))}function gt(t,e,a,r){return t.editor.createModel(e,a,r?K(t,r):void 0)}function K(t,e){return t.Uri.parse(e)}var yt=Object.defineProperty,Y=Object.getOwnPropertySymbols,St=Object.prototype.hasOwnProperty,_t=Object.prototype.propertyIsEnumerable,G=(t,e,a)=>e in t?yt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a,wt=(t,e)=>{for(var a in e||(e={}))St.call(e,a)&&G(t,a,e[a]);if(Y)for(var a of Y(e))_t.call(e,a)&&G(t,a,e[a]);return t};const At={display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"};var bt=J({name:"VueMonacoEditor",model:{prop:"value",event:"update:value"},props:{defaultValue:String,defaultPath:String,defaultLanguage:String,value:String,language:String,path:String,theme:{type:String,default:"vs"},line:Number,options:{type:Object,default:()=>({})},overrideServices:{type:Object,default:()=>({})},saveViewState:{type:Boolean,default:!0},width:{type:[Number,String],default:"100%"},height:{type:[Number,String],default:"100%"},className:String},emits:["update:value","beforeMount","mount","change","validate"],setup(t,e){const a=new Map,r=O(null),{monacoRef:n,unload:p,isLoadFailed:l}=ft(),{editorRef:u}=Mt(e,t,n,r),{disposeValidator:S}=Ct(e,t,n,u),_=$(()=>!!n.value&&!!u.value),{wrapperStyle:g,containerStyle:i}=ht(t,_);return R(()=>{var s,C;(s=S.value)==null||s.call(S),u.value?((C=u.value.getModel())==null||C.dispose(),u.value.dispose()):p()}),b(()=>t.path,(s,C)=>{const N=q(n.value,t.value||t.defaultValue||"",t.language||t.defaultLanguage||"",s||t.defaultPath||"");N!==u.value.getModel()&&(t.saveViewState&&a.set(C,u.value.saveViewState()),u.value.setModel(N),t.saveViewState&&u.value.restoreViewState(a.get(s)))}),b(()=>t.value,s=>{u.value&&u.value.getValue()!==s&&u.value.setValue(s)}),b(()=>t.options,s=>u.value&&u.value.updateOptions(s),{deep:!0}),b(()=>t.theme,s=>n.value&&n.value.editor.setTheme(s)),b(()=>t.language,s=>_.value&&n.value.editor.setModelLanguage(u.value.getModel(),s)),b(()=>t.line,s=>{u.value&&!X(s)&&u.value.revealLine(s)}),{containerRef:r,isEditorReady:_,isLoadFailed:l,wrapperStyle:g,containerStyle:i}},render(){const{$slots:t,isEditorReady:e,isLoadFailed:a,wrapperStyle:r,containerStyle:n,className:p}=this;return V("div",{style:r},[!e&&V("div",{style:At},a?t.failure?W(t.failure):"load failed":t.default?W(t.default):"loading..."),V("div",{ref:"containerRef",key:"monaco_editor_container",style:n,class:p})])}});function Mt({emit:t},e,a,r){const n=O(null);z(()=>{const l=b(a,()=>{r.value&&a.value&&(Q(()=>l()),p())},{immediate:!0})});function p(){var l;if(!r.value||!a.value||n.value)return;t("beforeMount",a.value);const u=e.path||e.defaultPath,S=q(a.value,e.value||e.defaultValue||"",e.language||e.defaultLanguage||"",u||"");n.value=a.value.editor.create(r.value,wt({model:S,theme:e.theme,automaticLayout:!0,autoIndent:"brackets",formatOnPaste:!0,formatOnType:!0},e.options),e.overrideServices),(l=n.value)==null||l.onDidChangeModelContent(_=>{const g=n.value.getValue();g!==e.value&&(t("update:value",g),t("change",g,_))}),n.value&&!X(e.line)&&n.value.revealLine(e.line),t("mount",n.value,a.value)}return{editorRef:n}}function Ct({emit:t},e,a,r){const n=I(null),p=b([a,r],()=>{if(a.value&&r.value){Q(()=>p());const l=a.value.editor.onDidChangeMarkers(u=>{var S,_;const g=(_=(S=r.value)==null?void 0:S.getModel())==null?void 0:_.uri;if(g&&u.find(s=>s.path===g.path)){const s=a.value.editor.getModelMarkers({resource:g});t("validate",s)}});n.value=()=>l?.dispose()}});return{disposeValidator:n}}const Et=st(),Dt=J({props:["data","isStandAlone"],data(){return{automationString:"",errorMessage:null,basicExamples:[],srdFeatures:[],myAutomations:[],docu:{},importedBasicExample:null,importedSrdFeature:null,importedCustomAutomation:null,hasEditedName:!1,currentContext:"",md:Et,YAML:f,isMobile:Z}},components:{LabelledComponent:nt,VueMonacoEditor:bt,Modal:rt},setup(){const t=O(),e=n=>t.value=n;let a=I(0),r=setInterval(()=>{a.value=t.value?.getModel().getOffsetAt(t.value?.getPosition())},1e3);return R(()=>{clearInterval(r)}),{handleMount:e,editorRef:t,cursorPosition:a}},mounted(){this.automationString=f.stringify(this.data.automation)??f.stringify(null),fetch("/api/basic-examples/list").then(async t=>{let e=await w(t);e.success?this.basicExamples=e.data:this.basicExamples=[]}),fetch("/api/srd-features/list").then(async t=>{let e=await w(t);e.success?this.srdFeatures=e.data:this.srdFeatures=[]}),fetch("/api/my-automations").then(async t=>{let e=await w(t);e.success?this.myAutomations=e.data:c.error(e.data.error)}),this.getMyAutomations()},emits:["savedStandaloneData"],methods:{getMyAutomations(){fetch("/api/automationDocumentation").then(async t=>{let e=await w(t);e.success?this.docu=e.data:this.docu={}})},saveCustomAutomation(){fetch("/api/automation/add",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({data:{name:this.data.name,description:this.data.description,automation:this.data.automation}})}).then(async t=>{let e=await w(t);e.success?(this.getMyAutomations(),c.success("Successfully added automation!")):c.error(e.data.error)})},validateYaml(){try{return f.parse(this.automationString),this.errorMessage=null,!0}catch(t){return this.errorMessage=t,!1}},saveAutomation(t=!1){try{let e=f.parse(this.automationString);(e||e==null)&&fetch("/api/validate/automation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:e})}).then(a=>a.json()).then(a=>{e!=null&&!a.success?(t&&c.error("YAML contains Error, did not save automation"),this.errorMessage=a.error):(this.data.automation=f.parse(this.automationString),this.isStandAlone&&fetch(`/api/automation/${this.data._id}/update`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({data:this.data})}).then(async r=>{let n=await w(r);n.success&&t?(c.success("Saved Automation!"),this.$emit("savedStandaloneData")):n.success||c.error(`${this.data.name}:`+n.data.error)}),t&&!this.isStandAlone&&c.success("Saved Automation!"))})}catch{t&&c.error("YAML contains Error, did not save automation")}},async importExample(){if(!this.importedBasicExample)return;let t=null;await fetch("/api/basic-example/"+encodeURIComponent(this.importedBasicExample)).then(async e=>{let a=await w(e);a.success?t=a.data:(c.error("Error: "+a.data.error),t=null)}),t&&((this.data.name=="New Feature"||!this.hasEditedName)&&(this.data.name=t.name),this.data.description=t.description??"",this.automationString=f.stringify(t.automation),this.saveAutomation(!1),c.success("Successfully loaded: "+t.name))},async importSrdAction(){if(!this.importedSrdFeature)return;let t=null;if(await fetch("/api/srd-feature/"+encodeURIComponent(this.importedSrdFeature)).then(async e=>{let a=await w(e);a.success?t=a.data:(c.error("Error: "+a.data.error),t=null)}),!!t){if((this.data.name=="New Feature"||!this.hasEditedName)&&(t.automation!=null?this.data.name=t.name.split("-").slice(1).join("-").trim():this.data.name=t.name),this.data.description=t.description.replaceAll("$NAME$",this.data.description.name)??"",Array.isArray(t.automation))for(let e of t.automation)e.name=e.name.split("-").slice(1).join("-").trim();else t.automation!=null&&(t.automation.name=t.automation.name.split("-").slice(1).join("-").trim());this.automationString=f.stringify(t.automation),this.saveAutomation(!1),c.success("Successfully loaded: "+t.name)}},async importCustomAutomation(){if(!this.importCustomAutomation)return;let t=null;await fetch("/api/automation/"+encodeURIComponent(this.importedCustomAutomation._id.toString())).then(async e=>{let a=await w(e);a.success?t=a.data:(c.error("Error: "+a.data.error),t=null)}),t&&((this.data.name=="New Feature"||!this.hasEditedName)&&(t.automation!=null?this.data.name=t.name:this.data.name=t.name),this.data.description=t.description.replaceAll("$NAME$",this.data.description.name)??"",Array.isArray(t.automation)||(t.automation.name=t.automation.name),this.automationString=f.stringify(t.automation),this.saveAutomation(!1),c.success("Successfully loaded: "+t.name))},generateAutomation(){const t=it(this.data.description,this.data.name,0)[0];if(t)try{this.automationString=f.stringify(t),this.saveAutomation(!1)}catch{c.error("Something went when generating automation!")}},getAutomationDescription(){let t;try{t=f.parse(this.automationString)}catch{return!1}if(Array.isArray(t)||!this.data.automation||!t||t?.automation?.length==0)return!1;for(let e of t?.automation?.reverse()||[])if(e.type=="text")return e.text;return""},updateFeatureDescFromAutomationDesc(){let t;try{t=f.parse(this.automationString)}catch{return}if(!Array.isArray(t)){for(let e of t?.automation?.reverse()||[])if(e.type=="text"){this.data.description=e.text;return}}},updateAutomationDescFromFeatureDesc(){let t;try{t=f.parse(this.automationString)}catch{return}if(!Array.isArray(t)){for(let e of t?.automation?.reverse()||[])if(e.type=="text"){e.text=this.data.description,t.automation.reverse(),this.automationString=f.stringify(t);return}}},copyAutomation(){navigator.clipboard.writeText(this.automationString),c.success("Copied automation to clipboard!")},getContext(){const t=this.automationString;let e="",a="",r=this.cursorPosition;t.slice(Math.max(r-6,0),Math.min(r+6,t.length)).includes("type:")&&(r+=6);for(let p=r;p--;p<t.length)if(e=t.charAt(p)+e,e.startsWith("type:")){a=t.slice(p).match(/type['"]?:\s*['"]?(\w+)['"]?/)?.[1]||"";break}this.currentContext=a}},computed:{showDescriptionButtons(){const t=this.data.description,e=this.getAutomationDescription();return Array.isArray(this.data.automation)||!t||!e?!1:t!=e},getLanguage(){return this.automationString.startsWith("{")||this.automationString.startsWith("[")?"json":"yaml"},currentDocu(){return this.docu[this.currentContext]}},watch:{automationString(){if(this.validateYaml(),this.data.name=="New Feature"||this.data.description=="")try{let t=f.parse(this.automationString);if(Array.isArray(t))if(t.length>0)t=t[0];else return;if(t.name&&this.data.name=="New Feature"&&(this.data.name=t.name.replace(" (1H)","").replace(" (2H)","")),t.automation&&this.data.description==""){for(let e in t.automation)if(t.automation[e].type=="text"){this.data.description=t.automation[e].text;break}}}catch{}},cursorPosition(){this.getContext()}}}),v=t=>(at("data-v-3c5a3115"),t=t(),ot(),t),kt={class:"two-wide uneven"},Ot={class:"editor-field__container two-wide"},Vt=v(()=>o("a",{href:"https://avrae.readthedocs.io/en/stable/automation_ref.html"}," Documentation",-1)),Lt=v(()=>o("br",null,null,-1)),Ft={href:"https://avrae.io/dashboard/characters"},Pt={class:"editor-field__container"},$t={class:"editor-field__container two-wide"},It={key:0,class:"editor-field__container two-wide"},Nt=v(()=>o("hr",null,null,-1)),Tt={class:"editor-field__container"},jt={class:"editor-field__container"},Ut={key:1,class:"editor-field__container"},Bt={key:2},Ht=v(()=>o("hr",null,null,-1)),Wt=["innerHTML"],Yt={key:3},Gt=v(()=>o("hr",null,null,-1)),Jt=v(()=>o("p",{class:"warning"},"Feature description and last automation text node do not match.",-1)),Rt=v(()=>o("p",null,"You can update the other with the buttons here.",-1)),zt={class:"two-wide editor-field__container"},Qt={class:"automation-editor"},Xt={class:"two-wide uneven"},qt=v(()=>o("div",null,null,-1)),Kt={key:0,class:"docs"},Zt=v(()=>o("hr",null,null,-1)),xt=["innerHTML"],te=v(()=>o("hr",null,null,-1)),ee=v(()=>o("h4",null,"Overview",-1)),ae=["href"],oe={key:0},ne=v(()=>o("hr",null,null,-1)),ie=v(()=>o("h4",null,"Options",-1)),re={class:"highlight"},se=["innerHTML"],le={key:1},ue=v(()=>o("hr",null,null,-1)),de=v(()=>o("h4",null,"Exposed Variables",-1)),ce={class:"highlight"},me=["innerHTML"];function pe(t,e,a,r,n,p){const l=E("LabelledComponent"),u=E("font-awesome-icon"),S=E("v-select"),_=E("VueMonacoEditor"),g=tt("tooltip");return m(),h(L,null,[o("div",kt,[o("div",null,[o("div",Ot,[d(l,{title:"Feature name"},{default:y(()=>[D(o("input",{type:"text",id:"featurename",placeholder:"Enter name","onUpdate:modelValue":e[0]||(e[0]=i=>t.data.name=i),onChange:e[1]||(e[1]=i=>t.hasEditedName=!0)},null,544),[[j,t.data.name]])]),_:1}),d(l,{title:"Documentation"},{default:y(()=>[o("div",null,[Vt,M(),Lt,D((m(),h("a",Ft,[M(" Automation Editor")])),[[g,"Edit automation on a character to get access to the full fledged automation builder."]])])]),_:1})]),o("div",Pt,[d(l,{title:"Feature description"},{default:y(()=>[D(o("textarea",{height:"94",id:"featuredescription",placeholder:"Enter description","onUpdate:modelValue":e[2]||(e[2]=i=>t.data.description=i),style:{height:"93px"}},null,512),[[j,t.data.description]])]),_:1})]),o("div",$t,[d(l,{title:"Save automation"},{default:y(()=>[o("button",{class:"btn confirm",onClick:e[3]||(e[3]=i=>t.saveAutomation(!0)),id:"saveautomation"},"Save")]),_:1}),d(l,{title:"Generate"},{default:y(()=>[D((m(),h("button",{class:"btn",onClick:e[4]||(e[4]=(...i)=>t.generateAutomation&&t.generateAutomation(...i)),id:"generate"},[M(" Generate "),d(u,{icon:["fas","circle-info"]})])),[[g,"Generate automation from description. May be incomplete or inaccurate. Only works for basic, to hit attacks."]])]),_:1})]),t.isMobile?(m(),h("div",It,[d(l,{title:"Clear automation"},{default:y(()=>[o("button",{class:"btn danger",onClick:e[5]||(e[5]=i=>t.automationString="null"),id:"clearautomation"},"Clear")]),_:1}),d(l,{title:"Copy Automation"},{default:y(()=>[o("button",{class:"btn",onClick:e[6]||(e[6]=i=>t.copyAutomation()),id:"copyautomation"},"Copy")]),_:1})])):A("",!0),Nt,o("div",Tt,[d(l,{title:"Import SRD feature"},{default:y(()=>[d(S,{options:t.srdFeatures,modelValue:t.importedSrdFeature,"onUpdate:modelValue":e[7]||(e[7]=i=>t.importedSrdFeature=i),inputId:"importsrdfeature"},null,8,["options","modelValue"]),o("button",{class:"btn move-down",onClick:e[8]||(e[8]=(...i)=>t.importSrdAction&&t.importSrdAction(...i))},"Load")]),_:1})]),o("div",jt,[d(l,{title:"Import basic example"},{default:y(()=>[d(S,{options:t.basicExamples,modelValue:t.importedBasicExample,"onUpdate:modelValue":e[9]||(e[9]=i=>t.importedBasicExample=i),inputId:"importbasicexample"},null,8,["options","modelValue"]),o("button",{class:"btn move-down",onClick:e[10]||(e[10]=(...i)=>t.importExample&&t.importExample(...i))},"Load")]),_:1})]),t.isStandAlone?A("",!0):(m(),h("div",Ut,[d(l,{title:"Import custom automation"},{default:y(()=>[d(S,{options:t.myAutomations,modelValue:t.importedCustomAutomation,"onUpdate:modelValue":e[11]||(e[11]=i=>t.importedCustomAutomation=i),inputId:"importcustomautomation",label:"name"},null,8,["options","modelValue"]),o("button",{class:"btn move-down",onClick:e[12]||(e[12]=(...i)=>t.importCustomAutomation&&t.importCustomAutomation(...i))},"Load")]),_:1})])),t.errorMessage?(m(),h("div",Bt,[Ht,o("span",{class:"yaml-error",innerHTML:t.errorMessage},null,8,Wt)])):A("",!0),t.showDescriptionButtons&&(t.errorMessage==null||t.errorMessage?.length==0)?(m(),h("div",Yt,[Gt,Jt,Rt,o("div",zt,[d(l,{title:"Update from automation"},{default:y(()=>[o("button",{class:"btn",onClick:e[13]||(e[13]=(...i)=>t.updateFeatureDescFromAutomationDesc&&t.updateFeatureDescFromAutomationDesc(...i))},"Update")]),_:1}),d(l,{title:"Update from description"},{default:y(()=>[o("button",{class:"btn",onClick:e[14]||(e[14]=(...i)=>t.updateAutomationDescFromFeatureDesc&&t.updateAutomationDescFromFeatureDesc(...i))},"Update")]),_:1})])])):A("",!0)]),o("div",Qt,[d(_,{value:t.automationString,"onUpdate:value":e[15]||(e[15]=i=>t.automationString=i),theme:"vs-dark",options:{wordWrap:"on",theme:"vs-dark",minimap:{enabled:!1},formatOnPaste:!0,formatOnType:!0,automaticLayout:!0,scrollBeyondLastLine:!1},height:"750px",language:t.getLanguage,onMount:t.handleMount},null,8,["value","language","onMount"]),!t.isStandAlone&&t.automationString?(m(),h("span",{key:0,class:"save-custom-automation",onClick:e[16]||(e[16]=i=>t.saveCustomAutomation())},"Click to save as a reusable custom automation!")):A("",!0)])]),o("div",Xt,[qt,t.currentDocu?(m(),h("div",Kt,[Zt,o("h3",null,"Documentation: "+k(t.currentContext),1),o("p",{class:"small",innerHTML:t.md.render(t.currentDocu.desc)},null,8,xt),o("div",null,[te,ee,M(" See full documentation "),o("a",{href:"https://avrae.readthedocs.io/en/stable/automation_ref.html#"+t.currentDocu.url,target:"_blank"},"here",8,ae),M(". "),t.currentDocu?.ts?(m(),et(_,{key:0,value:`// Values denoted with an ? are optional.
`+t.currentDocu.ts,theme:"vs-dark",options:{wordWrap:"on",theme:"vs-dark",minimap:{enabled:!1},automaticLayout:!0,readOnly:!0,scrollBeyondLastLine:!1},language:"json",height:"200px"},null,8,["value"])):A("",!0)]),t.currentDocu?.opt?(m(),h("div",oe,[ne,ie,o("ul",null,[(m(!0),h(L,null,U(t.currentDocu.opt,(i,s)=>(m(),h("li",null,[o("span",null,[o("code",re,k(s),1),o("span",{innerHTML:t.md.render(i)},null,8,se)])]))),256))])])):A("",!0),t.currentDocu?.variables?(m(),h("div",le,[ue,de,o("ul",null,[(m(!0),h(L,null,U(t.currentDocu.variables,(i,s)=>(m(),h("li",null,[o("span",null,[o("span",ce,k(s),1),M(" ["),o("code",null,k(i.type),1),M("] "),o("span",{innerHTML:t.md.render(i.desc)},null,8,me)])]))),256))])])):A("",!0)])):A("",!0)])],64)}const ye=x(Dt,[["render",pe],["__scopeId","data-v-3c5a3115"]]);export{ye as A};
