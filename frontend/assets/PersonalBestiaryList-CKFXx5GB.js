import{d as S,U as N,u as T,h as y,t as u,_ as U,r as l,y as j,o,c as r,a as n,l as d,A as b,b as a,F as _,H as A,z as L,f as p,i as w,C as B,w as v,e as g,T as V,p as z,j as O}from"./index-BB4lYkn2.js";import{B as P}from"./Breadcrumbs-C_TjxZoK.js";import{S as R}from"./StatusIcon-5TdyZ5f6.js";import{M as F}from"./Modal-BChtR01s.js";const E=S({components:{UserBanner:N,Breadcrumbs:P,StatusIcon:R,Modal:F},data(){return{bestiaries:[],userData:null,deleteId:"",showDeleteModal:!1,selectedBestiary:null}},async beforeMount(){const e=this.$loading.show();this.userData=await T,this.getBestiaries(),e.hide()},methods:{async createBestiary(){await fetch("/api/bestiary/update",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({data:{name:"New bestiary",description:"",status:"private",creatures:[]}})}).then(async s=>{let i=await y(s);i.success?(u.success("Created bestiary"),this.$router.push("/bestiary-viewer/"+i.data._id)):u.error(i.data.error)}),await this.getBestiaries()},async deleteBestiary(e){if(!e)return;const s=this.$loading.show();await fetch(`/api/bestiary/${e._id}/delete`).then(async i=>{let c=await y(i);c.success?(u.success("Deleted bestiary succesfully"),this.showDeleteModal=!1):u.error(c.data.error)}),s.hide(),await this.getBestiaries()},async getBestiaries(){await fetch("/api/my-bestiaries").then(async e=>{let s=await y(e);s.success?this.bestiaries=s.data:(this.bestiaries=[],u.error(s.data.error))})},openDeleteModal(e){this.selectedBestiary=e,this.showDeleteModal=!0}},computed:{bestiaryImages(){let e=[];for(let s of this.bestiaries){const i=s.description.match(/\!\[.*?\]\((.*?)\)/),c=(i||[])[1];i&&(s.description=s.description.replace(i[0],"")),e.push(c)}return e}}}),C=e=>(z("data-v-a75fab4b"),e=e(),O(),e),G={class:"content"},H={key:0,class:"tile-container"},J={class:"tile-header"},Y={key:0,class:"shared-notice"},q=["src"],K={class:"tags"},Q={class:"description"},W={class:"tile-footer"},X=["onClick"],Z={key:1},x={key:1,class:"zero-found"},ee=C(()=>a("span",null," You do not have any bestiaries. ",-1)),se=C(()=>a("p",{class:"modal-desc"},"Please confirm you want to permanently delete this bestiary. This action is not reversible.",-1));function te(e,s,i,c,ae,oe){const h=l("font-awesome-icon"),k=l("Breadcrumbs"),D=l("StatusIcon"),M=l("UserBanner"),I=l("RouterLink"),$=l("Modal"),m=j("tooltip");return o(),r(_,null,[n(k,{routes:[{path:"",text:"My Bestiaries",isCurrent:!0}]},{default:d(()=>[b((o(),r("button",{onClick:s[0]||(s[0]=(...t)=>e.createBestiary&&e.createBestiary(...t)),class:"inverted","aria-label":"Create bestiary"},[n(h,{icon:["fas","plus"]})])),[[m,"Create bestiary!"]])]),_:1}),a("div",G,[e.bestiaries?(o(),r("div",H,[n(V,{name:"popin"},{default:d(()=>[(o(!0),r(_,null,A(e.bestiaries,(t,f)=>(o(),L(I,{class:B(["content-tile bestiary-tile",{"four-tall":t.owner!=e.userData?._id}]),to:"/bestiary-viewer/"+t._id,key:t._id?.toString(),"aria-label":`Open Bestiary ${t.name}`},{default:d(()=>[a("div",J,[a("h2",null,p(t.name),1)]),t.owner!=e.userData?._id?(o(),r("span",Y,"(shared)")):w("",!0),a("div",{class:B(["tile-content",{"tile-has-image":e.bestiaryImages[f]}])},[e.bestiaryImages[f]?(o(),r("img",{key:0,class:"tile-image",src:e.bestiaryImages[f]},null,8,q)):w("",!0),a("div",K,p(t.tags.join(", ")),1),a("p",Q,p(t.description),1)],2),a("div",W,[b((o(),r("span",null,[n(D,{icon:t.status},null,8,["icon"])])),[[m,t.status,void 0,{left:!0}]]),t.owner==e.userData?._id?b((o(),r("span",{key:0,role:"button",onClick:v(ie=>e.openDeleteModal(t),["stop","prevent"]),class:"edit-button","aria-label":"Delete bestiary"},[n(h,{icon:["fas","trash"]})],8,X)),[[m,"Delete bestiary"]]):(o(),r("span",Z,[n(M,{id:t.owner},null,8,["id"])])),a("span",null,[g(p(t.creatures.length),1),n(h,{icon:["fas","skull"]})])])]),_:2},1032,["to","class","aria-label"]))),128))]),_:1})])):(o(),r("div",x,[ee,a("button",{class:"btn confirm",onClick:s[1]||(s[1]=(...t)=>e.createBestiary&&e.createBestiary(...t))},"Create a bestiary")]))]),n($,{show:e.showDeleteModal,onClose:s[4]||(s[4]=t=>e.showDeleteModal=!1)},{header:d(()=>[g("Are you sure you want to delete "+p(e.selectedBestiary?.name),1)]),body:d(()=>[se]),footer:d(()=>[a("button",{class:"btn",onClick:s[2]||(s[2]=t=>e.showDeleteModal=!1)},"Cancel"),a("button",{class:"btn danger",onClick:s[3]||(s[3]=v(()=>e.deleteBestiary(e.selectedBestiary),["prevent"]))},"Confirm")]),_:1},8,["show"])],64)}const ce=U(E,[["render",te],["__scopeId","data-v-a75fab4b"]]);export{ce as default};
