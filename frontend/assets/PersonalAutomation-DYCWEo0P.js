import{d as M,f as c,e as x,g as k,K as u,J as B,L as H,h as T,i as U,o as s,j as r,k as d,w as v,l as a,c as $,B as F,F as D,m as p,x as P,z,t as K,H as L,u as O,G as I,n as Y,_ as j}from"./index-DQ6A1txX.js";import{_ as G}from"./Breadcrumbs.vue_vue_type_style_index_0_lang-Bad4t9Mn.js";import{L as _}from"./constants-BwsMr4Io.js";import{A as R}from"./AutomationEditor-D6mzrkoO.js";import{_ as q}from"./Modal.vue_vue_type_style_index_0_lang-CQ7delUW.js";import{$ as C}from"./loading-Bqzaws9C.js";import"./markdownItAnchor-VSsJ9PWr.js";const Q={class:"content"},W={class:"wrapper"},X={class:"left"},Z={key:0},tt=["onClick"],et=["aria-label"],ot={key:1},at=["minlength","maxlength"],nt={class:"automation-editor"},it={key:1,class:"no-selected"},st={class:"two-wide"},lt=M({__name:"PersonalAutomation",setup(rt){const i=c([]),f=c("");x(async()=>{const e=C.show();await b(),f.value=JSON.stringify(i.value),e.hide()});const l=c(null),w=c("New Automation"),S=async(e,t=null,n=!0)=>{if(e==="New Automation"){u.warning("Automation must have a non-default name!");return}const m=C.show(),{success:o,error:g}=await k("/api/automation/add","POST",{name:e,automation:t});o?(await b(),w.value="New Automation",n&&u.success(`Successfully added automation: ${e}`),l.value=i.value[i.value.length-1]):u.error(g),m.hide()},J=async e=>{const t=C.show(),{success:n,error:m}=await k(`/api/automation/${e.toString()}/delete`);n?(u.success("Successfully deleted the automation!"),await b(),l.value=null):u.error(m),t.hide()},b=async()=>{const{success:e,data:t,error:n}=await k("/api/my-automations");e?i.value=t:u.error(n),f.value=JSON.stringify(i.value)},V=async()=>{await navigator.clipboard.writeText(JSON.stringify(i.value.map(e=>e.automation))),u.success("Copied all automation to clipboard.")},y=c(!1),h=c(""),E=async()=>{const e=JSON.parse(h.value);for(const t of e){let n;t!=null&&(Array.isArray(t)?n=t[0].name.replace(" (1H)","").replace(" (2H)",""):n=t.name,await S(n,t,!1))}u.info("Importing automation has finished."),y.value=!1};B(()=>{if(f.value!==JSON.stringify(i.value)&&!window.confirm("Do you really want to leave? You have unsaved changes."))return!1});const N=e=>{f.value!==JSON.stringify(i.value)&&(window.confirm("Do you really want to leave? you have unsaved changes."),e.preventDefault(),e.returnValue=!0)};x(()=>{window.addEventListener("beforeunload",N)}),H(()=>{window.removeEventListener("beforeunload",N)});const A=c(!0);return(e,t)=>{const n=T("font-awesome-icon"),m=U("tooltip");return s(),r(D,null,[d(G,{routes:[{path:"",text:"My Automation",isCurrent:!0}]},{default:v(()=>[p((s(),r("button",{"aria-label":"Change editor",onClick:t[0]||(t[0]=o=>A.value=!A.value)},[d(n,{icon:["fas","arrow-right-to-bracket"]})])),[[m,"Change editor"]]),p((s(),r("button",{"aria-label":"Import a list of automation",onClick:t[1]||(t[1]=o=>y.value=!0)},[d(n,{icon:["fas","arrow-right-to-bracket"]})])),[[m,"Import a list of automation"]]),p((s(),r("button",{"aria-label":"Export all automations to your clipboard",onClick:t[2]||(t[2]=o=>V())},[d(n,{icon:["fas","arrow-right-from-bracket"]})])),[[m,"Export all automations to your clipboard"]])]),_:1}),a("div",Q,[a("div",W,[a("div",X,[d(_,{title:"List"},{default:v(()=>[i.value&&i.value.length>0?(s(),r("ol",Z,[(s(!0),r(D,null,P(i.value,(o,g)=>(s(),r("li",{key:g,class:z(["feature-button__container",{selected:o._id===l.value?._id}]),onClick:ut=>l.value=o},[a("p",{role:"button","aria-label":`Select automation: ${o.name} (${g})`},K(o.name||"Unnamed feature"),9,et)],10,tt))),128))])):(s(),r("p",ot," You do not have any personal automations. "))]),_:1}),d(_,{title:"Add new automation",for:"addnewautomation"},{default:v(()=>[p(a("input",{id:"addnewautomation","onUpdate:modelValue":t[3]||(t[3]=o=>w.value=o),type:"text",minlength:O(I).limits?.nameMin,maxlength:O(I).limits?.nameLength},null,8,at),[[L,w.value]]),a("button",{class:"btn confirm",onClick:t[4]||(t[4]=o=>S(w.value))}," Add ")]),_:1}),l.value?(s(),$(_,{key:0,title:"Delete automation"},{default:v(()=>[a("button",{class:"btn danger",onClick:t[5]||(t[5]=o=>J(l.value._id))}," Delete current ")]),_:1})):F("",!0)]),t[9]||(t[9]=a("hr",null,null,-1)),a("div",nt,[l.value?(s(),$(R,{key:l.value?._id.toString(),"is-visual-editor":A.value,data:l.value,"is-stand-alone":!0,onSavedStandaloneData:t[6]||(t[6]=o=>f.value=JSON.stringify(i.value))},null,8,["is-visual-editor","data"])):(s(),r("div",it," Select an automation to get started with editing it. "))])])]),d(q,{show:y.value,onClose:t[8]||(t[8]=o=>y.value=!1)},{header:v(()=>t[10]||(t[10]=[Y(" Import Automation ")])),body:v(()=>[d(_,{title:"List of automation",for:"listInput"},{default:v(()=>[t[11]||(t[11]=a("p",null,"Insert a list of automation in JSON format.",-1)),a("div",st,[p(a("input",{id:"listInput","onUpdate:modelValue":t[7]||(t[7]=o=>h.value=o),type:"text",placeholder:"JSON"},null,512),[[L,h.value]]),a("button",{class:"btn confirm",onClick:E}," Import ")])]),_:1}),t[12]||(t[12]=a("hr",null,null,-1))]),_:1},8,["show"])],64)}}}),yt=j(lt,[["__scopeId","data-v-76ce17ce"]]);export{yt as default};
