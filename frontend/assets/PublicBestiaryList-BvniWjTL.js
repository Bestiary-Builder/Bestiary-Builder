import{d as E,I as U,U as N,J as O,h as j,t as F,_ as P,r as m,y as V,o as n,c,a as p,l as h,A as _,G as R,b as o,D as z,F as L,H as G,z as A,f as y,i as D,C as J,e as S,T as H,p as q,j as K}from"./index-DHg13qmf.js";import{B as Q}from"./Breadcrumbs-Hr7R_kEe.js";import W from"./BookmarkedBestiaryList-CCeX4Qiz.js";function X(e,t){let s=null;const r=typeof t=="number"?t:function(u){const[l,d="ms"]=String(u).split(/(ms|s)/i);return Number(l)*{ms:1,s:1e3}[d]}(t),k=function(){for(var u=arguments.length,l=new Array(u),d=0;d<u;d++)l[d]=arguments[d];const g=()=>{s=null,e.apply(this,l)};clearTimeout(s),s=setTimeout(g,r),s||e.apply(this,l)};return k.cancel=()=>{clearTimeout(s),s=null},k}function M(e){return e.map(t=>t.toLowerCase())}function Y(e,t){const s=e?e["debounce-events"]:[];return s&&s.length>0?Array.isArray(s)?M(s):M(s.split(",")):M((r=t,Array.isArray(r)?r:r==null?[]:[r]));var r}function $(e){return e===""}function Z(e,t){return e==="Enter"&&(!t.lock||t.unlock)}function x(e,t,s){return $(e)&&s.fireonempty&&(t==="Enter"||t===" ")}function ee(){let{lock:e=!1,listenTo:t="keyup",defaultTime:s="300ms",fireOnEmpty:r=!1,cancelOnEmpty:k=!1,trim:u=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return{created(l,d,g){let{value:w,arg:I=s,modifiers:T}=d;const b=Object.assign({lock:e,trim:u,fireonempty:r,cancelonempty:k},T),f=Y(g.props,t),B=X(i=>{w(i.target.value,i)},I);function a(i){const C=b.trim?i.target.value.trim():i.target.value;$(C)&&b.cancelonempty?B.cancel():Z(i.key,b)||x(C,i.key,b)?(B.cancel(),w(i.target.value,i)):B(i)}f.forEach(i=>{l.addEventListener(i,a)})}}}const te=E({directives:{debounce:ee({lock:!0})},data(){return{bestiaries:[],page:1,total:1,search:"",selectedTags:[],tags:[],lastInput:0,viewMode:"Popular",isMobile:U}},components:{UserBanner:N,Breadcrumbs:Q,BookmarkedBestiaryList:W},async beforeMount(){const e=this.$loading.show();this.tags=await O??[],this.searchBestiaries(),e.hide()},watch:{page(){this.searchBestiaries()},selectedTags(){this.searchBestiaries()},async viewMode(e){if(e!="Bookmarked"){const t=this.$loading.show();await this.searchBestiaries(),t.hide()}}},methods:{async searchBestiaries(){await fetch("/api/search",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({options:{search:this.search,page:this.page-1,tags:this.selectedTags,mode:this.viewMode.toLowerCase()}})}).then(async e=>{let t=await j(e);if(t.success){let s=t.data;this.bestiaries=s.results,this.total=s.pageAmount}else this.bestiaries=[],this.total=1,F.error(t.data.error)})}},computed:{bestiaryImages(){let e=[];for(let t of this.bestiaries){const s=t.description.match(/\!\[.*?\]\((.*?)\)/),r=(s||[])[1];s&&(t.description=t.description.replace(s[0],"")),e.push(r)}return e}}}),v=e=>(q("data-v-0fb63473"),e=e(),K(),e),se=v(()=>o("option",null,"Recent",-1)),ae=v(()=>o("option",null,"Popular",-1)),oe=v(()=>o("option",null,"Bookmarked",-1)),ie=[se,ae,oe],ne={"aria-label":"Filter bestiaries"},re={class:"v-popper__custom-menu"},le=v(()=>o("span",null,[o("label",{for:"tagsInput"},"Filter by tags")],-1)),ce={"aria-label":"Search bestiaries"},de={class:"v-popper__custom-menu"},pe=v(()=>o("span",null," Search bestiaries by name or description",-1)),ue={key:0,class:"content"},me={key:0,class:"tile-container"},he={class:"tile-header"},ge=["src"],be={class:"tags"},fe={class:"description"},_e={class:"tile-footer"},ye={key:1,class:"zero-found"},ve=v(()=>o("span",null," Did not find any Bestiaries with that name or tags.",-1)),ke=[ve],Be={key:2,class:"page-nav__container"};function we(e,t,s,r,k,u){const l=m("font-awesome-icon"),d=m("v-select"),g=m("VDropdown"),w=m("Breadcrumbs"),I=m("UserBanner"),T=m("RouterLink"),b=m("BookmarkedBestiaryList"),f=V("tooltip"),B=V("debounce");return n(),c(L,null,[p(w,{routes:[{path:"",text:"Public Bestiaries",isCurrent:!0}]},{default:h(()=>[_(o("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>e.viewMode=a),"aria-label":"Select public bestiary list mode",name:"Select public bestiary list mode"},ie,512),[[R,e.viewMode]]),p(g,{distance:6,"positioning-disabled":!1},{popper:h(()=>[o("div",re,[le,p(d,{placeholder:"Select Tags",modelValue:e.selectedTags,"onUpdate:modelValue":t[1]||(t[1]=a=>e.selectedTags=a),multiple:"",options:e.tags,inputId:"tagsInput"},null,8,["modelValue","options"])])]),default:h(()=>[_((n(),c("button",ne,[p(l,{icon:["fas","tag"]})])),[[f,"Filter bestiaries"]])]),_:1}),p(g,{distance:6,"positioning-disabled":e.isMobile},{popper:h(()=>[o("div",de,[pe,_(o("input",{id:"searchinput",type:"text","onUpdate:modelValue":t[2]||(t[2]=a=>e.search=a),placeholder:"Search by bestiary name or description"},null,512),[[z,e.search],[B,e.searchBestiaries,"600ms",{fireonempty:!0}]])])]),default:h(()=>[_((n(),c("button",ce,[p(l,{icon:["fas","magnifying-glass"]})])),[[f,"Search bestiaries"]])]),_:1},8,["positioning-disabled"])]),_:1}),e.viewMode!="Bookmarked"?(n(),c("div",ue,[e.bestiaries&&e.bestiaries.length>0?(n(),c("div",me,[p(H,{name:"popin"},{default:h(()=>[(n(!0),c(L,null,G(e.bestiaries,(a,i)=>(n(),A(T,{class:"content-tile bestiary-tile",to:"/bestiary-viewer/"+a._id,key:a._id?.toString(),"aria-label":`Open ${a.name}`},{default:h(()=>[o("h2",he,y(a.name),1),o("div",{class:J(["tile-content",{"tile-has-image":e.bestiaryImages[i]}])},[e.bestiaryImages[i]?(n(),c("img",{key:0,class:"tile-image",src:e.bestiaryImages[i]},null,8,ge)):D("",!0),o("div",be,y(a.tags.join(", ")),1),o("p",fe,y(a.description),1)],2),o("div",_e,[p(I,{id:a.owner},null,8,["id"]),o("span",null,[S(y(a.creatures.length),1),p(l,{icon:["fas","skull"]})])])]),_:2},1032,["to","aria-label"]))),128))]),_:1})])):(n(),c("div",ye,ke)),e.total>1?(n(),c("div",Be,[_((n(),c("button",{"aria-label":"Decrease page number",onClick:t[3]||(t[3]=a=>e.page=Math.max(1,e.page-1))},[S("-")])),[[f,"Decrease page number"]]),o("span",null,y(e.page)+"/"+y(e.total),1),_((n(),c("button",{"aria-label":"Increase page number",onClick:t[4]||(t[4]=a=>e.page=Math.min(e.total,e.page+1))},[S("+")])),[[f,"Increase page number"]])])):D("",!0)])):(n(),A(b,{key:1}))],64)}const Me=P(te,[["render",we],["__scopeId","data-v-0fb63473"]]);export{Me as default};
