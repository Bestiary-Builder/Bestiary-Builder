import{U as j,S as G}from"./StatusIcon-COz_s1qn.js";import{_ as K,t as u}from"./Breadcrumbs.vue_vue_type_style_index_0_lang-D1kcEJMB.js";import{L as Q,c as X}from"./LabelledComponent-B9SZKuiR.js";import{_ as Y}from"./Modal.vue_vue_type_style_index_0_lang-By_BwBhp.js";import{S as Z,c as x}from"./StatblockRenderer-C-Puc8OF.js";import{d as _,f as V,q as I,x as T,H as N,g as f,_ as ee,h as w,i as J,o,j as l,c as O,w as d,m as s,k as a,l as c,p as $,n as C,z as b,v as te,y as g,t as S,C as P,F as U,B as L,T as se,I as re}from"./index-BnguSVmB.js";import{_ as ie}from"./Markdown.vue_vue_type_script_setup_true_lang-KRE3SOwo.js";import{$ as B}from"./loading-CBYs1_jt.js";import"./markdownItAnchor-VSsJ9PWr.js";const oe=_({components:{UserBanner:j,StatblockRenderer:Z,Breadcrumbs:K,StatusIcon:G,LabelledComponent:Q,Modal:Y,Markdown:ie},setup(){const e=V(""),t=I(e,500),r=V(""),n=I(r,500),p=V(""),m=I(p,500);return{searchText:e,debouncedSearch:t,searchEnv:r,debouncedEnv:n,searchFaction:p,debouncedFaction:m}},data(){return{bestiary:null,savedBestiary:null,creatures:null,searchCreatureList:[],editors:[],lastHoveredCreature:null,lastClickedCreature:null,hasPinnedBefore:!1,bookmarked:!1,isOwner:!1,isEditor:!1,editorToAdd:"",showWarning:!1,critterDbId:"",bestiaryBuilderJson:"",notices:{},searchOptions:{text:"",tags:[],minCr:0,maxCr:30,env:"",faction:""},sortMode:"Alphabetically",isExpanded:!1,showEditorModal:!1,showImportModal:!1,selectedCreature:null,srdCreatures:[],store:T,creatureTypes:x,defaultStatblock:N}},computed:{searchCreatures(){if(this.creatures==null)return null;const e=B.show(),t=this.creatures?.filter(r=>this.filterCreature(r))||null;return this.sortMode==="Alphabetically"?t.sort((r,n)=>{const p=r.stats.description.name.toLowerCase(),m=n.stats.description.name.toLowerCase();return p<m?-1:p>m?1:0}):this.sortMode==="Creature Type"?t.sort((r,n)=>{const p=r.stats.core.race.toLowerCase(),m=n.stats.core.race.toLowerCase();return p<m?-1:p>m?1:0}):this.sortMode==="CR Descending"?t.sort((r,n)=>n.stats.description.cr-r.stats.description.cr):this.sortMode==="CR Ascending"&&t.sort((r,n)=>r.stats.description.cr-n.stats.description.cr),e.hide(),t}},watch:{lastClickedCreature(){this.hasPinnedBefore||(this.hasPinnedBefore||(this.hasPinnedBefore=!0),u.info("Pinned creature to the view. Click unpin there to go back to hover behaviour."))},"bestiary.status":function(e,t){e==="private"&&(this.showWarning=!1),e==="public"&&(this.showWarning=!0)},"bestiary.name":function(){document.title=`${this?.bestiary?.name.substring(0,16)} | Bestiary Builder`},debouncedSearch(){this.searchOptions.text=this.searchText},debouncedEnv(){this.searchOptions.env=this.searchEnv},debouncedFaction(){this.searchOptions.faction=this.searchFaction}},async mounted(){const e=B.show();this.getBestiary(),e.hide(),this?.bestiary?.name&&(document.title=`${this?.bestiary?.name.substring(0,16)} | Bestiary Builder`);const{success:t,data:r,error:n}=await f("/api/srd-creatures/list");t&&(this.srdCreatures=r),n&&u.error(n)},methods:{filterCreature(e){const t=[];return this.searchOptions.text!==""&&t.push(e.stats.description.name.toLowerCase().includes(this.searchOptions.text.toLowerCase().trim())),this.searchOptions.env!==""&&t.push(e.stats.description.environment.toLowerCase().includes(this.searchOptions.env.toLowerCase().trim())),this.searchOptions.faction!==""&&t.push(e.stats.description.faction.toLowerCase().includes(this.searchOptions.faction.toLowerCase().trim())),this.searchOptions.tags.length>0&&t.push(this.searchOptions.tags.some(r=>e.stats.core.race.toLowerCase().includes(r.toLowerCase()))),(this.searchOptions.minCr!==0||this.searchOptions.maxCr!==30)&&t.push(this.searchOptions.minCr<=e.stats.description.cr&&e.stats.description.cr<=this.searchOptions.maxCr),t.every(r=>r)},async exportBestiary(e){if(e){const t=new File([JSON.stringify(this.creatures?.map(p=>p.stats),null,2)],"Creatures.txt",{type:"text/plain"}),r=document.createElement("a"),n=URL.createObjectURL(t);r.href=n,r.download=t.name,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(n)}else await navigator.clipboard.writeText(JSON.stringify(this.creatures?.map(t=>t.stats),null,2)),u.info("Exported this bestiary to your clipboard.")},async importBestiaryFromCritterDB(){let e=this.critterDbId.trim();const t=e.includes("publishedbestiary");if(!e.startsWith("https://critterdb.com")&&!e.startsWith("critterdb.com")){u.error("Could not recognize link as a link to a CritterDB bestiary");return}const r=e.split("/");e=r[r.length-1],u.info("Fetching bestiary data has started. This may take a while.");const n=B.show(),{success:p,data:m,error:y}=await f(`/api/critterdb/${e}/${t}`);if(p){m.failedCreatures.length>0&&u.error(`Failed to parse ${m.failedCreatures.length} creatures, due to invalid data recieved.`);for(const M of m.failedCreatures)this.notices[M]="Failed to parse, due to unrecognized data."}else{u.error(y),n.hide();return}u.info("Saving creatures has started. This may take a while.");const{success:h,data:v,error:E}=await f(`/api/bestiary/${this.bestiary?._id?.toString()}/addcreatures`,"POST",m.data.creatures);if(!h)this.notices={},u.error(E);else if(v.error){u.error("The import was completed with errors."),this.notices.Errors=v.error;for(const M of v.ignoredCreatures)this.notices[M.creature]=M.error}await this.getBestiary(),n.hide(),u.success("Importing has finished!"),h&&!v.error&&(this.showImportModal=!1)},async importCreaturesFromBestiaryBuilder(){let e;const t=B.show();try{e=JSON.parse(this.bestiaryBuilderJson)}catch(m){console.error(m),u.error("Something is wrong with the format of your JSON"),t.hide();return}u.info("Importing creatures has started. This may take a while.");const{success:r,data:n,error:p}=await f(`/api/bestiary/${this.bestiary?._id?.toString()}/addcreatures`,"POST",e);if(!r)this.notices={},u.error(p);else if(n.error){u.error("The import was completed with errors."),this.notices.Errors=n.error;for(const m of n.ignoredCreatures)this.notices[m.creature]=m.error}else u.success("Importing has finished!");await this.getBestiary(),t.hide(),r&&!n.error&&(this.showImportModal=!1)},async createCreature(e=N,t=!0){let r;t&&(r=B.show());const n={stats:e,bestiary:this.bestiary?._id},{success:p,data:m,error:y}=await f("/api/creature/add","POST",n);if(p){const h=m;await this.$router.push(`../statblock-editor/${h._id?.toString()}`)}else u.error(y);t&&r&&r.hide()},async deleteCreature(e){const t=B.show(),{success:r,error:n}=await f(`/api/creature/${e._id?.toString()}/delete`);if(r){if(u.success("Deleted creature succesfully"),!this.bestiary)return;this.bestiary.creatures=this.bestiary.creatures.filter(p=>p!==e._id),this.creatures=this.creatures?.filter(p=>p._id!==e._id)??[]}else u.error(n);t.hide()},async importSrdCreature(e){const{success:t,data:r,error:n}=await f(`/api/srd-creature/${encodeURIComponent(e)}`);if(t)return await this.createCreature(r),r;u.error(n)},async addEditor(){if(!this.bestiary)return;const e=this.editorToAdd,t=B.show(),{success:r,error:n}=await f(`/api/bestiary/${this.bestiary._id?.toString()}/editors/add/${e}`);r?u.success("Added editor succesfully"):u.error(n),await this.getBestiary(),t.hide()},async removeEditor(e){if(!this.bestiary)return;const t=B.show(),{success:r,error:n}=await f(`/api/bestiary/${this.bestiary._id?.toString()}/editors/remove/${e}`);r?u.success("Removed editor succesfully"):u.error(n),await this.getBestiary(),t.hide()},async getBestiary(){const e=this.$route.params.id,{success:t,data:r,error:n}=await f(`/api/bestiary/${e.toString()}`);if(!t){this.bestiary=null,u.error(n);return}this.bestiary=r,this.savedBestiary=this.bestiary,this.isOwner=T.user?._id===this.bestiary.owner,this.isEditor=(this.bestiary?.editors??[]).includes(T.user?._id??""),await f(`/api/bestiary/${this.bestiary._id?.toString()}/creatures`).then(async p=>{p.success?this.creatures=p.data:(this.creatures=null,u.error(p.error))}),this.editors=[];for(const p of this.bestiary?.editors??[])await f(`/api/user/${p}`).then(m=>{m.success?this.editors.push(m.data):u.error(m.error)});T.user?await f(`/api/bestiary/${this.bestiary._id?.toString()}/bookmark/get`).then(async p=>{p.success?this.bookmarked=p.data.state:(this.bookmarked=!1,u.error(p.error))}):this.bookmarked=!1},async updateBestiary(){if(!this.bestiary)return;const e=B.show(),{success:t,error:r}=await f(`/api/bestiary/${this.bestiary._id?.toString()}/update`,"POST",this.bestiary);t?(u.success("Saved bestiary"),this.savedBestiary=this.bestiary,this.showEditorModal=!1):u.error(r),e.hide()},async toggleBookmark(){if(!this.bestiary)return;const e=B.show(),{success:t,data:r,error:n}=await f(`/api/bestiary/${this.bestiary._id?.toString()}/bookmark/toggle`);t?(this.bookmarked=r.state,this.bookmarked?u.success("Successfully bookmarked this bestiary!"):u.success("Successfully unbookmarked this bestiary!")):(this.bookmarked=!1,u.error(n)),e.hide()},setSelectedCreature(e){this.lastHoveredCreature=e},changeCR(e,t){let r;t?r=this.searchOptions.minCr:r=this.searchOptions.maxCr,r===0&&e?r=.125:r===.125&&e?r=.25:r===.25&&e?r=.5:r===.5&&e?r=1:r===.125&&!e?r=0:r===.25&&!e?r=.125:r===.5&&!e?r=.25:r===1&&!e?r=.5:e?r=Math.min(30,r+1):r=Math.max(0,r-1),t?this.searchOptions.minCr=r:this.searchOptions.maxCr=r},crAsString:X}}),ae={class:"inverted","aria-label":"Create creature"},ne={class:"v-popper__custom-menu"},le={"aria-label":"Filter bestiary"},de={class:"v-popper__custom-menu"},ue={style:{"min-width":"300px"}},pe={class:"two-wide"},ce={class:"flow-vertically"},me={class:"quantity"},he={class:"quantity-nav"},be={class:"flow-vertically"},ye={class:"quantity"},fe={class:"quantity-nav"},Ce={key:0,class:"warning",style:{"text-align":"center"}},ke={"aria-label":"Export bestiary"},we={class:"v-popper__custom-menu"},ve={class:"content"},ge={key:0,class:"bestiary"},Se={class:"left-side-container"},Be={class:"content-tile header-tile"},Oe={key:0,class:"bookmark-enabled"},$e={key:1,class:"bookmark-disabled"},Ee={class:"tile-container list-tiles"},Me=["onMouseover","onClick"],De={class:"left-side"},Fe={class:"right-side"},Te=["aria-label"],Ve={class:"v-popper__custom-menu"},Ie=["onClick"],Ue=["aria-label"],Le={class:"cr"},Re={key:0,class:"create-tile"},Ae={class:"v-popper__custom-menu"},qe={key:0,class:"statblock-container"},Ne={key:0,class:"pin-notice"},Je={key:1,class:"statblock-container"},Pe={class:"flow-horizontally"},ze={class:"flow-horizontally"},He={key:0},We=["minlength","maxlength"],je=["maxlength"],Ge={key:0,class:"two-wide"},Ke={class:"editor-block"},Qe={key:0},Xe={class:"editor-container"},Ye=["onClick"],Ze={class:"button-container"},xe={key:1,class:"warning"};function _e(e,t,r,n,p,m){const y=w("font-awesome-icon"),h=w("LabelledComponent"),v=w("v-select"),E=w("VDropdown"),M=w("Breadcrumbs"),z=w("Markdown"),R=w("UserBanner"),H=w("StatusIcon"),A=w("RouterLink"),W=w("StatblockRenderer"),q=w("Modal"),k=J("tooltip"),F=J("close-popper");return o(),l("div",null,[e.bestiary?(o(),O(M,{key:0,routes:[{path:e.isOwner||e.isEditor?"../my-bestiaries/":"../bestiaries",text:e.isOwner||e.isEditor?"My Bestiaries":"Bestiaries",isCurrent:!1},{path:"",text:e.bestiary?.name,isCurrent:!0}]},{default:d(()=>[e.isOwner||e.isEditor?(o(),O(E,{key:0,distance:6,placement:"top","positioning-disabled":e.store.isMobile},{popper:d(()=>[s("div",ne,[a(h,{title:"From Scratch",for:"fromScratch"},{default:d(()=>[c((o(),l("button",{id:"fromScratch",class:"btn",onClick:t[0]||(t[0]=$(i=>e.createCreature(),["stop"]))},t[37]||(t[37]=[C(" From scratch ")]))),[[F]])]),_:1}),a(h,{title:"From SRD Creature",for:"fromSrd"},{default:d(()=>[a(v,{options:e.srdCreatures,"input-id":"fromSrd",placeholder:"Select SRD creature",style:{"min-width":"300px"},"onOption:selected":t[1]||(t[1]=i=>e.importSrdCreature(i))},null,8,["options"])]),_:1})])]),default:d(()=>[c((o(),l("button",ae,[a(y,{icon:["fas","plus"]})])),[[k,"Create creature!"]])]),_:1},8,["positioning-disabled"])):b("",!0),e.lastClickedCreature?c((o(),l("button",{key:1,style:{rotate:"45deg"},"aria-label":"Unpin currently pinned creature",onClick:t[2]||(t[2]=i=>e.lastClickedCreature=null)},[a(y,{icon:["fas","thumbtack"]})])),[[k,"Unpin currently pinned creature!"]]):b("",!0),e.isOwner?c((o(),l("button",{key:2,"aria-label":"Edit bestiary",onClick:t[3]||(t[3]=i=>e.showEditorModal=!0)},[a(y,{icon:["fas","pen-to-square"]})])),[[k,"Edit bestiary!"]]):b("",!0),a(E,{distance:6,"positioning-disabled":e.store.isMobile},{popper:d(()=>[s("div",de,[a(h,{title:"Sort creatures",for:"sortcreatures"},{default:d(()=>[c(s("select",{id:"sortcreatures","onUpdate:modelValue":t[4]||(t[4]=i=>e.sortMode=i),name:"Sort bestiary by attribute"},t[38]||(t[38]=[s("option",null,"Alphabetically",-1),s("option",null,"CR Ascending",-1),s("option",null,"CR Descending",-1),s("option",null,"Creature Type",-1)]),512),[[te,e.sortMode]])]),_:1}),a(h,{title:"Filter",for:"searchtext"},{default:d(()=>[c(s("input",{id:"searchtext","onUpdate:modelValue":t[5]||(t[5]=i=>e.searchText=i),type:"text",placeholder:"Search by name..."},null,512),[[g,e.searchText]])]),_:1}),a(h,{title:"Creature type",for:"creatureType"},{default:d(()=>[s("div",ue,[a(v,{modelValue:e.searchOptions.tags,"onUpdate:modelValue":t[6]||(t[6]=i=>e.searchOptions.tags=i),placeholder:"Search by creature type",multiple:"",options:e.creatureTypes,"input-id":"creaturetype",taggable:!0},null,8,["modelValue","options"])])]),_:1}),s("div",pe,[s("div",ce,[t[39]||(t[39]=s("label",{class:"editor-field__title",for:"challengerating"},[s("span",{class:"text"}," Minimum CR")],-1)),s("div",me,[c(s("input",{id:"minimumcr","onUpdate:modelValue":t[7]||(t[7]=i=>e.searchOptions.minCr=i),type:"number",min:"0",max:"30",inputmode:"numeric"},null,512),[[g,e.searchOptions.minCr]]),s("div",he,[s("div",{class:"quantity-button quantity-up","aria-label":"Increase minimum CR",onClick:t[8]||(t[8]=i=>e.changeCR(!0,!0))}," + "),s("div",{class:"quantity-button quantity-down","aria-label":"Decrease maximum CR",onClick:t[9]||(t[9]=i=>e.changeCR(!1,!0))}," - ")])])]),s("div",be,[t[40]||(t[40]=s("label",{class:"editor-field__title",for:"challengerating"},[s("span",{class:"text"}," Maximum CR")],-1)),s("div",ye,[c(s("input",{id:"maximumcr","onUpdate:modelValue":t[10]||(t[10]=i=>e.searchOptions.maxCr=i),type:"number",min:"0",max:"30",inputmode:"numeric"},null,512),[[g,e.searchOptions.maxCr]]),s("div",fe,[s("div",{class:"quantity-button quantity-up","aria-label":"Increase minimum CR",onClick:t[11]||(t[11]=i=>e.changeCR(!0,!1))}," + "),s("div",{class:"quantity-button quantity-down","aria-label":"Decrease maximum CR",onClick:t[12]||(t[12]=i=>e.changeCR(!1,!1))}," - ")])])])]),e.searchOptions.minCr>e.searchOptions.maxCr?(o(),l("span",Ce," Min is bigger than max ")):b("",!0),a(h,{title:"Environment",for:"environment"},{default:d(()=>[c(s("input",{id:"environment","onUpdate:modelValue":t[13]||(t[13]=i=>e.searchEnv=i),type:"text",placeholder:"Search by name..."},null,512),[[g,e.searchEnv]])]),_:1}),a(h,{title:"Faction",for:"faction"},{default:d(()=>[c(s("input",{id:"faction","onUpdate:modelValue":t[14]||(t[14]=i=>e.searchFaction=i),type:"text",placeholder:"Search by name..."},null,512),[[g,e.searchFaction]])]),_:1})])]),default:d(()=>[c((o(),l("button",le,[a(y,{icon:["fas","tag"]})])),[[k,"Filter bestiary"]])]),_:1},8,["positioning-disabled"]),e.isOwner?c((o(),l("button",{key:3,"aria-label":"Import bestiary",onClick:t[15]||(t[15]=i=>e.showImportModal=!0)},[a(y,{icon:["fas","arrow-right-to-bracket"]})])),[[k,"Import bestiary"]]):b("",!0),a(E,{distance:6,"positioning-disabled":e.store.isMobile},{popper:d(()=>[s("div",we,[t[43]||(t[43]=s("span",null,[C(" Export this Bestiary as JSON"),s("br"),C(" to clipboard or to file ")],-1)),c((o(),l("button",{class:"btn confirm",onClick:t[16]||(t[16]=i=>e.exportBestiary(!1))},t[41]||(t[41]=[C(" Clipboard ")]))),[[F]]),c((o(),l("button",{class:"btn confirm",onClick:t[17]||(t[17]=i=>e.exportBestiary(!0))},t[42]||(t[42]=[C(" File ")]))),[[F]])])]),default:d(()=>[c((o(),l("button",ke,[a(y,{icon:["fas","arrow-right-from-bracket"]})])),[[k,"Export bestiary"]])]),_:1},8,["positioning-disabled"])]),_:1},8,["routes"])):b("",!0),s("div",ve,[e.bestiary?(o(),l("div",ge,[s("div",Se,[s("div",Be,[s("h2",null,S(e.bestiary.name?e.bestiary.name:"..."),1),a(z,{class:P(["description",{expanded:e.isExpanded}]),text:e.bestiary.description||"No description set.",tag:"p"},null,8,["class","text"]),e.bestiary.description.length>0?c((o(),l("button",{key:0,class:"expand-btn","aria-label":"Expand description",onClick:t[18]||(t[18]=i=>e.isExpanded=!e.isExpanded)},[C(S(e.isExpanded?"▲":"▼"),1)])),[[k,"Expand description"]]):b("",!0),t[44]||(t[44]=s("hr",null,null,-1)),s("div",{class:P(["footer",{"three-wide":e.isOwner}])},[a(R,{id:e.bestiary.owner},null,8,["id"]),c((o(),l("div",null,[a(H,{icon:e.bestiary.status},null,8,["icon"])])),[[k,e.bestiary.status,void 0,{left:!0}]]),s("div",null,[C(S(e.bestiary.creatures.length),1),a(y,{icon:["fas","skull"]})]),e.isOwner?b("",!0):(o(),l("div",{key:0,role:"button","aria-label":"Toggle bookmark status",class:"bookmark",onClick:t[19]||(t[19]=$((...i)=>e.toggleBookmark&&e.toggleBookmark(...i),["prevent"]))},[e.bookmarked?c((o(),l("span",Oe,[a(y,{icon:["fas","star"]})])),[[k,"Unbookmark this bestiary"]]):c((o(),l("span",$e,[a(y,{icon:["fas","star"]})])),[[k,"Bookmark this bestiary"]])]))],2)]),s("div",Ee,[a(se,{name:"slide-fade"},{default:d(()=>[(o(!0),l(U,null,L(e.searchCreatures,i=>(o(),l("div",{key:i._id?.toString(),class:"content-tile creature-tile",onMouseover:D=>e.lastHoveredCreature=i.stats,onClick:D=>e.lastClickedCreature=i.stats},[s("div",De,[s("h3",null,S(i.stats?.description?.name),1),s("span",null,S(i.stats?.core?.size)+" "+S(i.stats?.core?.race)+S(i.stats?.description?.alignment?`, ${i.stats?.description?.alignment}`:""),1)]),s("div",Fe,[e.isOwner||e.isEditor?(o(),O(E,{key:0,distance:6,"positioning-disabled":e.store.isMobile},{popper:d(()=>[s("div",Ve,[t[46]||(t[46]=s("span",null," Are you sure you want to delete this creature? ",-1)),c((o(),l("button",{class:"btn danger",onClick:$(D=>e.deleteCreature(i),["stop"])},t[45]||(t[45]=[C(" Confirm ")]),8,Ie)),[[F]])])]),default:d(()=>[c((o(),l("button",{"aria-label":`Delete ${i.stats.description.name}`,onClick:t[20]||(t[20]=$(()=>{},["stop","prevent"]))},[a(y,{icon:["fas","trash"]})],8,Te)),[[k,"Delete creature"]])]),_:2},1032,["positioning-disabled"])):b("",!0),c((o(),l("button",{"aria-label":`${e.isOwner||e.isEditor?"Edit":"View"} ${i.stats.description.name}`,class:"edit-creature",onClick:$(()=>{},["stop"])},[a(A,{class:"creature",to:`/statblock-editor/${i._id}`,"aria-label":`${e.isOwner||e.isEditor?"Edit":"View"} creature`},{default:d(()=>[e.isOwner||e.isEditor?(o(),O(y,{key:0,icon:["fas","pen-to-square"]})):(o(),O(y,{key:1,icon:["fas","eye"]}))]),_:2},1032,["to","aria-label"])],8,Ue)),[[k,`${e.isOwner||e.isEditor?"Edit":"View"} creature`]]),s("span",Le," CR "+S(e.crAsString(i.stats.description.cr)),1)])],40,Me))),128))]),_:1}),e.isOwner||e.isEditor?(o(),l("div",Re,[e.isOwner||e.isEditor?(o(),O(E,{key:0,distance:6,placement:"top","positioning-disabled":e.store.isMobile},{popper:d(()=>[s("div",Ae,[a(h,{title:"From Scratch",for:"fromScratch"},{default:d(()=>[c((o(),l("button",{id:"fromScratch",class:"btn",onClick:t[21]||(t[21]=$(i=>e.createCreature(),["stop"]))},t[47]||(t[47]=[C(" From scratch ")]))),[[F]])]),_:1}),a(h,{title:"From SRD Creature",for:"fromSrd"},{default:d(()=>[a(v,{options:e.srdCreatures,"input-id":"fromSrd",placeholder:"Select SRD creature",style:{"min-width":"300px"},"onOption:selected":t[22]||(t[22]=i=>e.importSrdCreature(i))},null,8,["options"])]),_:1})])]),default:d(()=>[t[48]||(t[48]=s("span",{role:"button",class:"create-text"},"Add Creature",-1))]),_:1},8,["positioning-disabled"])):b("",!0)])):b("",!0)])]),e.creatures&&e.lastHoveredCreature?(o(),l("div",qe,[e.lastClickedCreature?(o(),l("span",Ne,[s("span",{class:"unpin-button",role:"button","aria-label":"unpin currently pinned creature",onClick:t[23]||(t[23]=i=>e.lastClickedCreature=null)},t[49]||(t[49]=[s("b",null,"unpin",-1)])),t[50]||(t[50]=C("📌 "))])):b("",!0),a(re,{name:"fade",mode:"out-in"},{default:d(()=>[(o(),O(W,{key:e.lastClickedCreature?.description.name||e.lastHoveredCreature.description.name,data:e.lastClickedCreature||e.lastHoveredCreature},null,8,["data"]))]),_:1})])):(o(),l("div",Je,t[51]||(t[51]=[s("div",{class:"no-creature-text"},[s("p",null,"Hover or click on a creature to see its statblock")],-1)])))])):b("",!0)]),e.bestiary&&e.isOwner?(o(),O(q,{key:1,show:e.showImportModal,onClose:t[28]||(t[28]=i=>e.showImportModal=!1)},{header:d(()=>t[52]||(t[52]=[C(" Import Creatures ")])),body:d(()=>[a(h,{title:"CritterDB bestiary link",for:"critterlink"},{default:d(()=>[t[53]||(t[53]=s("p",null,"Insert a link to a critterDB bestiary to import all its creatures.",-1)),t[54]||(t[54]=s("p",null,"Make sure the bestiary is public or has link sharing enabled.",-1)),s("div",Pe,[c(s("input",{id:"critterlink","onUpdate:modelValue":t[24]||(t[24]=i=>e.critterDbId=i),type:"text",placeholder:"CritterDB bestiary link"},null,512),[[g,e.critterDbId]]),s("button",{class:"btn confirm",onClick:t[25]||(t[25]=$((...i)=>e.importBestiaryFromCritterDB&&e.importBestiaryFromCritterDB(...i),["prevent"]))}," Import ")])]),_:1}),t[57]||(t[57]=s("hr",null,null,-1)),a(h,{title:"Bestiary Builder JSON",for:"bestiaryjson"},{default:d(()=>[t[55]||(t[55]=s("p",null,"Insert the JSON as text gotten from clicking export on another bestiary within Bestiary Builder.",-1)),s("div",ze,[c(s("input",{id:"bestiaryjson","onUpdate:modelValue":t[26]||(t[26]=i=>e.bestiaryBuilderJson=i),type:"text",placeholder:"Bestiary builder JSON"},null,512),[[g,e.bestiaryBuilderJson]]),s("button",{class:"btn confirm",onClick:t[27]||(t[27]=$((...i)=>e.importCreaturesFromBestiaryBuilder&&e.importCreaturesFromBestiaryBuilder(...i),["prevent"]))}," Import ")])]),_:1}),t[58]||(t[58]=s("hr",null,null,-1)),JSON.stringify(e.notices)!=="{}"?(o(),l("div",He,[t[56]||(t[56]=s("p",{class:"warning"},[s("b",null,"Please note the following for this import:")],-1)),(o(!0),l(U,null,L(e.notices,(i,D)=>(o(),l("div",{key:D},[s("h3",null,S(D),1),s("p",null,S(i),1)]))),128))])):b("",!0)]),_:1},8,["show"])):b("",!0),e.bestiary&&e.isOwner?(o(),O(q,{key:2,show:e.showEditorModal,onClose:t[36]||(t[36]=i=>e.showEditorModal=!1)},{header:d(()=>t[59]||(t[59]=[C(" Edit Bestiary ")])),body:d(()=>[a(h,{title:"Bestiary name",for:"bestiaryname"},{default:d(()=>[c(s("input",{id:"bestiaryname","onUpdate:modelValue":t[29]||(t[29]=i=>e.bestiary.name=i),type:"text",minlength:e.store.limits?.nameMin,maxlength:e.store.limits?.nameLength},null,8,We),[[g,e.bestiary.name]])]),_:1}),a(h,{title:"Description",for:"description"},{default:d(()=>[t[60]||(t[60]=s("p",null,"Supports markdown",-1)),c(s("textarea",{id:"description","onUpdate:modelValue":t[30]||(t[30]=i=>e.bestiary.description=i),maxlength:e.store.limits?.descriptionLength},null,8,je),[[g,e.bestiary.description]])]),_:1}),e.isOwner?(o(),l("div",Ge,[a(h,{title:"Status",for:"status"},{default:d(()=>[a(v,{modelValue:e.bestiary.status,"onUpdate:modelValue":t[31]||(t[31]=i=>e.bestiary.status=i),options:["public","unlisted","private"],"input-id":"status"},null,8,["modelValue"])]),_:1}),a(h,{title:"Tags",for:"tags"},{default:d(()=>[a(v,{modelValue:e.bestiary.tags,"onUpdate:modelValue":t[32]||(t[32]=i=>e.bestiary.tags=i),placeholder:"Select Tags",multiple:"",options:e.store.tags,"input-id":"tags"},null,8,["modelValue","options"])]),_:1})])):b("",!0),s("div",Ke,[t[62]||(t[62]=s("h3",null,"Editors",-1)),e.isOwner?(o(),l("p",Qe," Editors can add, edit, and remove creatures. They can edit the name of the bestiary and its description. Editors cannot change the status of the bestiary or delete the bestiary. Editors cannot add other editors. The owner can remove editors at any time. ")):b("",!0),s("div",Xe,[(o(!0),l(U,null,L(e.editors,i=>(o(),l("div",{key:i._id,class:"editor-list"},[s("p",null,[a(R,{id:i._id},null,8,["id"]),e.isOwner?(o(),l("span",{key:0,role:"button",class:"delete-creature",onClick:D=>e.removeEditor(i._id)},t[61]||(t[61]=[s("span",null,"🗑️",-1)]),8,Ye)):b("",!0)])]))),128))]),a(h,{title:"Add editor",for:"addeditor"},{default:d(()=>[s("div",Ze,[c(s("input",{id:"addeditor","onUpdate:modelValue":t[33]||(t[33]=i=>e.editorToAdd=i),type:"text",inputmode:"numeric",placeholder:"Discord user ID"},null,512),[[g,e.editorToAdd]]),s("button",{class:"btn",onClick:t[34]||(t[34]=i=>e.addEditor())}," Add ")])]),_:1})]),e.showWarning?(o(),l("p",xe,[t[64]||(t[64]=C(" By changing the bestiary status to public I confirm that I am the copyright holder of the content within, or that I have permission from the copyright holder to share this content. I hereby agree to the ")),a(A,{to:"../content-policy"},{default:d(()=>t[63]||(t[63]=[C(" Content Policy ")])),_:1}),t[65]||(t[65]=C(" and agree to be fully liable for the content within. I affirm that the content does not include any official non-free D&D content. Bestiaries that breach these terms may have their status changed to private or be outright removed, and may result in a ban if the content breaches our content policy. "))])):b("",!0)]),footer:d(()=>[s("button",{class:"btn confirm",onClick:t[35]||(t[35]=$((...i)=>e.updateBestiary&&e.updateBestiary(...i),["prevent"]))}," Save changes ")]),_:1},8,["show"])):b("",!0)])}const dt=ee(oe,[["render",_e],["__scopeId","data-v-89e782bb"]]);export{dt as default};
